(()=>{"use strict";const e={socket:io(),mapHeight:1e3,mapWidth:2e3};class t extends Phaser.Physics.Arcade.Sprite{constructor(e,t,s){super(e,t,s,"bullet"),this.scene=e}fire(t,s){e.socket.emit("newBullet",{angle:this.scene.player.angle,initial:{x:t,y:s},end:{x:this.scene.game.input.activePointer.worldX,y:this.scene.game.input.activePointer.worldY}}),this.body.reset(t,s),this.angle=this.scene.player.angle,this.scene.physics.moveTo(this,this.scene.game.input.activePointer.worldX,this.scene.game.input.activePointer.worldY,300),this.setActive(!0),this.setVisible(!0)}preUpdate(t,s){super.preUpdate(t,s),(this.y<=0||this.y>=e.mapHeight||this.x<=0||this.x>=e.mapWidth)&&(this.setActive(!1),this.setVisible(!1))}}class s extends Phaser.Physics.Arcade.Group{constructor(e){super(e.physics.world,e),this.createMultiple({frameQuantity:40,key:"bullet",setScale:{x:.07,y:.07},active:!1,visible:!1,classType:t})}fire(e,t){const s=this.getFirstDead(!1);s&&s.fire(e,t)}}const i=s;class a extends Phaser.Physics.Arcade.Sprite{constructor(t){super(t,Math.random()*e.mapWidth,Math.random()*e.mapHeight,"player"),this.nameText=t.add.text(this.x-40,this.y-100,t.name),t.add.existing(this),t.physics.add.existing(this),this.setScale(.5),t.cameras.main.startFollow(this,!0),this.setCollideWorldBounds(!0),e.socket.emit("newPlayer",{x:this.x,y:this.y,name:this.scene.name})}resetPos(){this.setPosition(Math.random()*e.mapWidth,Math.random()*e.mapHeight),this.resetNameText()}resetNameText(){this.nameText.setPosition(this.x-40,this.y-100)}}const h=a;class r extends Phaser.Scene{constructor(){super(),Phaser.Scene.call(this,{key:"game"})}init(){this.speed=3,this.score=0,this.sprintAcceleration=3,this.name=prompt("What would you like to be called?")}preload(){this.load.image("player","assets/images/player.png"),this.load.image("bullet","assets/images/bullet.png"),this.load.image("enemy","assets/images/enemy.png"),this.load.audio("pew","assets/sounds/shoot.mp3"),this.load.audio("music","assets/sounds/music.mp3")}create(){this.start=this.getTime(),e.socket.emit("ready"),this.sound.add("music",1,!0).play(),this.scoreText=this.add.text(10,10,"Score: 0"),this.scoreText.setScrollFactor(0,0),this.leaderboardText=this.add.text(2*this.cameras.main.centerX-250,10,""),this.leaderboardText.setScrollFactor(0,0),e.socket.on("leaderboard",(e=>{let t="Leaderboard:";e.forEach((e=>{t+=`\n\t${e}`})),this.leaderboardText.text=t})),this.players=this.physics.add.group(),e.socket.on("newPlayer",(e=>{const t=this.add.sprite(e.player.x,e.player.y,"enemy");t.nameText=this.add.text(e.player.x-40,e.player.y-100,e.player.name),t.setScale(.5),t.id=e.id,this.players.add(t)})),e.socket.on("players",(t=>{Object.keys(t).forEach((s=>{const i=t[s];s!=e.socket.id?this.players.getChildren().forEach((e=>{e.id==s&&(e.nameText.setPosition(i.x-30,i.y-100),e.setPosition(i.x,i.y),e.setAngle(i.angle))})):this.score=i.score}))})),e.socket.on("playerLeft",(e=>{this.players.getChildren().forEach((t=>{t.id==e&&(t.destroy(),t.nameText.destroy())}))})),this.physics.world.setBounds(0,0,e.mapWidth,e.mapHeight),this.cameras.main.setBounds(0,0,e.mapWidth,e.mapHeight),this.player=new h(this),this.myBullets=new i(this),this.theirBullets=this.physics.add.group(),this.physics.add.overlap(this.theirBullets,this.player,((t,s)=>{this.player.resetPos(),e.socket.emit("shot",s.id)})),e.socket.on("newBullet",(e=>{const t=this.physics.add.sprite(e.pos.initial.x,e.pos.initial.y,"bullet");t.id=e.id,t.setScale(.07),t.setAngle(e.pos.angle),this.theirBullets.add(t),this.physics.moveTo(t,e.pos.end.x,e.pos.end.y,300)})),this.pew=this.sound.add("pew",{volume:.05}),this.keys=this.input.keyboard.addKeys("W,A,S,D"),this.shiftKey=this.input.keyboard.addKey(16),this.input.on("pointermove",(e=>{const t=Phaser.Math.RAD_TO_DEG*Phaser.Math.Angle.Between(this.player.x,this.player.y,this.game.input.activePointer.worldX,this.game.input.activePointer.worldY);this.player.setAngle(t)}))}update(){let t=this.speed;this.shiftKey.isDown&&(t+=this.sprintAcceleration),this.keys.W.isDown&&(this.player.y-=t,this.cameras.main.scrollY-=t,this.player.resetNameText()),this.keys.S.isDown&&(this.player.y+=t,this.cameras.main.scrollY+=t,this.player.resetNameText()),this.keys.A.isDown&&(this.player.x-=t,this.cameras.main.scrollX-=t,this.player.resetNameText()),this.keys.D.isDown&&(this.player.x+=t,this.cameras.main.scrollX+=t,this.player.resetNameText()),this.input.activePointer.isDown&&this.showDelta()>100&&(this.pew.play(),this.myBullets.fire(this.player.x,this.player.y-20),this.start=this.getTime()),this.scoreText.text="Score: "+this.score,e.socket.emit("player",{x:this.player.x,y:this.player.y,angle:this.player.angle})}getTime(){return(new Date).getTime()}showDelta(){return this.getTime()-this.start}}const n=r;class o extends Phaser.Scene{constructor(){super(),Phaser.Scene.call(this,{key:"help"})}create(){this.backButton=this.add.text(0,0,"BACK",{fill:"#fc6b03"}),this.backButton.setInteractive(),this.backButton.on("pointerdown",(()=>{this.scene.switch("menu")})),this.add.text(this.cameras.main.centerX-300,this.cameras.main.centerY-100,"\n\t\t\tHow to play:\n                Use wasd keys to move\n                Hold down the cursor to shoot\n                Shoot the other players in order to earn points\n\t\t\tTip:\n\t\t\t\tHold shift to sprint\n            ")}}const c=o;class l extends Phaser.Scene{constructor(){super(),Phaser.Scene.call(this,{key:"menu"})}create(){const e={fill:"#fc6b03",fontSize:"150px",backgroundColor:"#a83232"};this.playButton=this.add.text(this.cameras.main.centerX-200,this.cameras.main.centerY-170,"PLAY",e),this.playButton.setInteractive(),this.playButton.on("pointerdown",(()=>{this.scene.switch("game")})),this.helpButton=this.add.text(this.cameras.main.centerX-200,this.cameras.main.centerY+5,"HELP",e),this.helpButton.setInteractive(),this.helpButton.on("pointerdown",(()=>{this.scene.switch("help")}))}}const d=l;firebase.initializeApp({apiKey:"AIzaSyDXU6Lw0B-Ma_LagtQ4OF-lmmwaAeZGBB8",authDomain:"grapple-ecd1c.firebaseapp.com",projectId:"grapple-ecd1c",storageBucket:"grapple-ecd1c.appspot.com",messagingSenderId:"874102344684",appId:"1:874102344684:web:5012c4dedb571774974ec9",measurementId:"G-7DFTRDPTLF",databaseURL:"https://grapple-ecd1c-default-rtdb.firebaseio.com/"}),firebase.analytics(),new Phaser.Game({width:window.innerWidth>e.mapWidth?e.mapWidth:window.innerWidth,height:window.innerHeight>e.mapHeight?e.mapHeight:window.innerHeight,physics:{default:"arcade",arcade:{debug:!1}},scene:[d,c,n]})})();